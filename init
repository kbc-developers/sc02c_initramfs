#!/sbin/busybox sh

. /mbs/mbs_const
. /mbs/mbs_funcs.sh

PATH_=$PATH
export PATH=/sbin

LOW_POWER_MODE=`mbs_func_get_low_power_mode`

if [ "$LOW_POWER_MODE" = '1' ]; then
    sh /mbs/init.lpm.sh
    export PATH=$PATH_
    exec /init
fi

# extract block device files
tar xf /misc/dev.tar

#foce single boot mode
BOOT_MODE=1

RECOVERY_MODE=`mbs_func_get_recovery_mode`

if [ "$RECOVERY_MODE" = '1' ]; then
    # recovery mode
    sh /mbs/init.recovery.sh $BOOT_MODE
else
    if [ "$BOOT_MODE" = "$MBS_BOOT_MODE_MULTI" ]; then
        #mbs mode
        mkdir /xdata
        cp /mbs/swrom /sbin
        sh /mbs/init.normal.multi.sh
    else
        #single boot mode
        mkdir /system
        mkdir /data
        chmod 0771 /data
        sh /mbs/init.normal.sh
    fi
fi

# cleanup
rm -rf /dev/* /misc/dev.tar

export PATH=$PATH_
exec /init

