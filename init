#!/sbin/busybox sh

. /mbs/mbs_const
. /mbs/mbs_funcs.sh

PATH_=$PATH
export PATH=/sbin

LOW_POWER_MODE=`mbs_func_get_low_power_mode`

if [ "$LOW_POWER_MODE" = '1' ]; then
  sh /mbs/init.lpm.sh
  export PATH=$PATH_
  exec /init
fi

# extract block device files
tar xf /misc/dev.tar

RECOVERY_MODE=`mbs_func_get_recovery_mode`

#foce single boot mode
IS_MODE=1

#check multi mode
if [ "$IS_MODE" = '0' ]; then
  #single boot mode
  mkdir /system
  mkdir /data
  chmod 0771 /data
  NORMAL_SH=/mbs/init.normal.sh
else
  #mbs mode
  mkdir /xdata
  NORMAL_SH=/mbs/init.normal.multi.sh

  cp /mbs/swrom /sbin
fi

#check boot mode
if [ "$RECOVERY_MODE" = '1' ]; then
  # recovery mode
  sh /mbs/init.recovery.sh $IS_MODE
else
  sh $NORMAL_SH
fi

# cleanup
rm -rf /dev/* /misc/dev.tar

export PATH=$PATH_
exec /init

